<!doctype html>
<html>
<head>
  <title>XiaoMoer.çš„å°çª</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="config/css/style.css">
  <!-- å¼•å…¥MDè§£æåº“ -->
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
</head>
<body class="body-A">
  <div class="card">
    <!-- å¤´åƒ+æ ‡é¢˜åŒºåŸŸ -->
    <div class="header-row">
      <box class="box-A">
        <img src="icon.ico" class="avatar">
      </box>
      <div class="title-group">
        <h1 class="title">ğ‘‹ğ‘–ğ‘ğ‘œğ‘€ğ‘œğ‘’ğ‘Ÿ.<sub style="font-size: 26px;">ğ’ğ‘­å°çª</sub></h1>
        <p class="subtitle">æˆ‘çš„åšå®¢_</p>
      </div>
    </div>

    <!-- é¡¶éƒ¨é€‰é¡¹æ  -->
    <nav class="option-bar">
      <a href="javascript:;" class="option-item active" data-type="all">å…¨éƒ¨æ–‡ç« </a>
      <a href="javascript:;" class="option-item" data-type="life">ç”Ÿæ´»éšç¬”</a>
      <a href="javascript:;" class="option-item" data-type="tech">æŠ€æœ¯åˆ†äº«</a>
      <a href="javascript:;" class="option-item" data-type="about">å…³äºæˆ‘</a>
    </nav>

    <!-- ä¸»ä½“å†…å®¹åŒºï¼šå·¦ä¾§æ–‡ç« åˆ—è¡¨ + å³ä¾§å†…å®¹å±•ç¤º -->
    <div class="main-container">
      <!-- å·¦ä¾§ï¼šæ–‡ç« åˆ—è¡¨ -->
      <div class="article-list" id="articleList">
        <p style="text-align: center; color: #777; padding: 20px 0;">åŠ è½½æ–‡ç« åˆ—è¡¨ä¸­...</p>
      </div>

      <!-- å³ä¾§ï¼šæ–‡ç« å†…å®¹å±•ç¤ºåŒº -->
      <div class="content-display" id="contentDisplay">
        <p style="text-align: center; color: #777; padding: 80px 0;">é€‰æ‹©å·¦ä¾§æ–‡ç« æŸ¥çœ‹å†…å®¹</p>
      </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
      <p>Â© 2024 XiaoMoer.çš„å°çª | ç”¨çƒ­çˆ±è®°å½•ç”Ÿæ´»</p>
      <div class="footer-extra">
        <p>HTML/CSS/JS AND Markdown.</p>
      </div>
    </footer>
  </div>

  <!-- æ ¸å¿ƒåŠŸèƒ½è„šæœ¬ï¼ˆæ–°å¢å›¾ç‰‡å¤§å°æ§åˆ¶ï¼‰ -->
  <script>
    const converter = new showdown.Converter();
    const optionItems = document.querySelectorAll('.option-item');
    const articleList = document.getElementById('articleList');
    const contentDisplay = document.getElementById('contentDisplay');

    // æ–‡ç« æ•°æ®
    const articleData = [
      {
        id: 1,
        title: "æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢ï¼šå¼€å§‹è®°å½•ç”Ÿæ´»",
        type: "life",
        date: "2025-10-30",
        path: "mdFiles/life/æ–‡ç« 1.md"
      },
      {
        id: 2,
        title: "ç½‘é¡µè§£æåˆ†äº«",
        type: "tech",
        date: "2025-10-30",
        path: "mdFiles/tech/æ–‡ç« 2.md"
      }
    ];

    // åˆå§‹åŠ è½½å…¨éƒ¨æ–‡ç« 
    renderArticleList('all');

    // é€‰é¡¹æ åˆ‡æ¢äº‹ä»¶
    optionItems.forEach(item => {
      item.addEventListener('click', function() {
        optionItems.forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
        const type = this.getAttribute('data-type');
        
        renderArticleList(type);
        
        if (type === 'about') {
          loadMdContent('mdFiles/å…³äºæˆ‘.md');
        } else {
          contentDisplay.innerHTML = '<p style="text-align: center; color: #777; padding: 80px 0;">é€‰æ‹©å·¦ä¾§æ–‡ç« æŸ¥çœ‹å†…å®¹</p>';
        }
      });
    });

    // æ¸²æŸ“æ–‡ç« åˆ—è¡¨
    function renderArticleList(type) {
      let filteredArticles = articleData;
      if (type !== 'all' && type !== 'about') {
        filteredArticles = articleData.filter(art => art.type === type);
      }

      if (filteredArticles.length === 0) {
        articleList.innerHTML = '<p style="text-align: center; color: #777; padding: 20px 0;">æš‚æ— è¯¥åˆ†ç±»æ–‡ç« </p>';
        return;
      }

      let html = '';
      filteredArticles.forEach(art => {
        html += `
          <div class="article-item" data-path="${art.path}">
            <h3 class="article-title">${art.title}</h3>
            <p class="article-meta">å‘å¸ƒäº ${art.date} Â· åˆ†ç±»ï¼š${art.type === 'life' ? 'ç”Ÿæ´»éšç¬”' : 'æŠ€æœ¯åˆ†äº«'}</p>
          </div>
        `;
      });
      articleList.innerHTML = html;

      document.querySelectorAll('.article-item').forEach(item => {
        item.addEventListener('click', function() {
          const mdPath = this.getAttribute('data-path');
          loadMdContent(mdPath);
        });
      });
    }

    // åŠ è½½å¹¶è§£æMDå†…å®¹ï¼ˆæ–°å¢å›¾ç‰‡å¤„ç†ï¼‰
    function loadMdContent(mdPath) {
      contentDisplay.innerHTML = '<p style="text-align: center; color: #777; padding: 80px 0;">åŠ è½½ä¸­...</p>';

      fetch(mdPath)
        .then(response => {
          if (!response.ok) throw new Error('å†…å®¹åŠ è½½å¤±è´¥');
          return response.text();
        })
        .then(mdText => {
          const html = converter.makeHtml(mdText);
          contentDisplay.innerHTML = html;
          // MDè§£æåï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰å›¾ç‰‡å¤§å°
          handleImagesSize();
        })
        .catch(error => {
          contentDisplay.innerHTML = `<p style="text-align: center; color: #ff4444; padding: 80px 0;">${error.message}</p>`;
        });
    }

    // æ ¸å¿ƒï¼šæ§åˆ¶å›¾ç‰‡å¤§å°ï¼ˆé™åˆ¶æœ€å¤§å®½åº¦å’Œé«˜åº¦ï¼‰
    function handleImagesSize() {
      const allImages = contentDisplay.querySelectorAll('img');
      const maxWidth = 700; // å›¾ç‰‡æœ€å¤§å®½åº¦ï¼ˆå¯è°ƒæ•´ï¼‰
      const maxHeight = 500; // å›¾ç‰‡æœ€å¤§é«˜åº¦ï¼ˆå¯è°ƒæ•´ï¼‰

      allImages.forEach(img => {
        // è®¾ç½®å›¾ç‰‡åŠ è½½å®Œæˆåå†è°ƒæ•´å¤§å°
        img.onload = function() {
          // ä¿æŒå›¾ç‰‡æ¯”ä¾‹ï¼Œé™åˆ¶åœ¨æœ€å¤§å°ºå¯¸å†…
          const imgWidth = img.naturalWidth;
          const imgHeight = img.naturalHeight;

          if (imgWidth > maxWidth || imgHeight > maxHeight) {
            const widthRatio = maxWidth / imgWidth;
            const heightRatio = maxHeight / imgHeight;
            const scaleRatio = Math.min(widthRatio, heightRatio); // å–æœ€å°æ¯”ä¾‹ï¼Œé¿å…è¶…å‡º

            img.style.width = `${imgWidth * scaleRatio}px`;
            img.style.height = 'auto'; // é«˜åº¦è‡ªåŠ¨é€‚åº”ï¼Œä¿æŒæ¯”ä¾‹
          }
          // æ·»åŠ å›¾ç‰‡æ ·å¼ï¼ˆè¾¹æ¡†ã€é—´è·ç­‰ï¼‰
          img.style.borderRadius = '8px';
          img.style.margin = '15px auto';
          img.style.display = 'block'; // å›¾ç‰‡å±…ä¸­æ˜¾ç¤º
        }

        // å¤„ç†åŠ è½½å¤±è´¥çš„å›¾ç‰‡
        img.onerror = function() {
          img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';
          img.style.border = '1px dashed #ff4444';
          img.style.padding = '20px';
        }
      });
    }
  </script>
</body>
</html>
